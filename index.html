<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Bedrock Agent 聊天介面</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts 的 Inter 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 使用 Noto Sans TC 作為主要字體 */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* 美化捲軸 */
        #chat-log::-webkit-scrollbar {
            width: 8px;
        }
        #chat-log::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        #chat-log::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        #chat-log::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="flex flex-col h-screen max-w-4xl mx-auto bg-white shadow-2xl rounded-lg my-0 sm:my-4 overflow-hidden">
        <!-- 標頭 -->
        <header class="bg-gray-800 text-white p-4 shadow-md z-10">
            <h1 class="text-xl font-bold text-center">AWS Bedrock Agent</h1>
            <p class="text-sm text-center text-gray-300">您的 AI 助理</p>
        </header>

        <!-- 聊天記錄區 -->
        <main id="chat-log" class="flex-1 p-6 overflow-y-auto bg-gray-50">
            <!-- 初始歡迎訊息 -->
            <div class="flex items-start gap-3 justify-start mb-6">
                <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold flex-shrink-0">A</div>
                <div class="bg-gray-200 p-4 rounded-lg max-w-lg">
                    <p class="text-gray-800">您好！我是您的 Bedrock Agent，請問有什麼可以為您服務的嗎？</p>
                </div>
            </div>
        </main>

        <!-- 輸入區 -->
        <footer class="p-4 bg-white border-t border-gray-200">
            <form id="chat-form" class="flex items-center space-x-4">
                <input 
                    id="user-input" 
                    type="text" 
                    placeholder="在這裡輸入您的訊息..." 
                    autocomplete="off"
                    class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300">
                <button 
                    type="submit"
                    class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-transform duration-200 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    id="send-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </form>
        </footer>
    </div>

    <script>
        const chatLog = document.getElementById('chat-log');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        // 監聽表單提交事件
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const messageText = userInput.value.trim();
            if (messageText) {
                // 顯示使用者訊息
                displayMessage(messageText, 'user');
                // 清空輸入框
                userInput.value = '';
                // 禁用發送按鈕
                setLoading(true);
                // 呼叫 Bedrock Agent
                callBedrockAgent(messageText);
            }
        });

        /**
         * 在聊天視窗中顯示訊息
         * @param {string} message - 要顯示的訊息內容
         * @param {string} sender - 發送者 ('user' 或 'agent')
         */
        function displayMessage(message, sender) {
            const messageWrapper = document.createElement('div');
            
            if (sender === 'user') {
                messageWrapper.className = 'flex items-start gap-3 justify-end mb-6 animate-fade-in-right';
                messageWrapper.innerHTML = `
                    <div class="bg-blue-600 text-white p-4 rounded-lg max-w-lg">
                        <p>${escapeHTML(message)}</p>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0">您</div>
                `;
            } else {
                messageWrapper.className = 'flex items-start gap-3 justify-start mb-6 animate-fade-in-left';
                messageWrapper.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold flex-shrink-0">A</div>
                    <div class="bg-gray-200 p-4 rounded-lg max-w-lg">
                        <p class="text-gray-800">${escapeHTML(message)}</p>
                    </div>
                `;
            }
            chatLog.appendChild(messageWrapper);
            // 捲動到最底部
            chatLog.scrollTop = chatLog.scrollHeight;
        }
        
        /**
         * 顯示或隱藏載入中的提示
         */
        function showLoadingIndicator(show) {
            let loadingIndicator = document.getElementById('loading-indicator');
            if (show) {
                if (!loadingIndicator) {
                    loadingIndicator = document.createElement('div');
                    loadingIndicator.id = 'loading-indicator';
                    loadingIndicator.className = 'flex items-start gap-3 justify-start mb-6';
                    loadingIndicator.innerHTML = `
                        <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold flex-shrink-0">A</div>
                        <div class="bg-gray-200 p-4 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></div>
                                <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                                <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                            </div>
                        </div>
                    `;
                    chatLog.appendChild(loadingIndicator);
                    chatLog.scrollTop = chatLog.scrollHeight;
                }
            } else {
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
            }
        }

        /**
         * 呼叫 AWS Bedrock Agent 的函數
         * @param {string} message - 使用者的輸入
         */
        async function callBedrockAgent(message) {
            showLoadingIndicator(true);

            // =================================================================
            // !! 重要 !!
            // 這裡您需要替換成實際呼叫後端 API 的邏輯。
            // 出於安全考量，AWS SDK 和憑證不應該直接放在前端。
            // 建議的作法是：
            // 1. 建立一個後端服務 (例如 AWS Lambda + API Gateway)。
            // 2. 這個後端服務負責接收前端的請求，並使用 AWS SDK 安全地呼叫 Bedrock Agent。
            // 3. 前端透過 fetch API 呼叫您的後端 API 端點。
            //
            // 以下是使用 fetch 的範例，請將 'YOUR_BACKEND_API_ENDPOINT' 換成您的 API Gateway URL。
            // =================================================================
            
            try {
                // --- 範例開始 (實際使用時請取消註解並修改) ---
                /*
                const response = await fetch('YOUR_BACKEND_API_ENDPOINT', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: message,
                        // 您可能還需要傳遞 session ID 等資訊
                    }),
                });

                if (!response.ok) {
                    throw new Error(`伺服器錯誤: ${response.status}`);
                }

                const data = await response.json();
                const agentResponse = data.completion; // 請根據您後端回傳的格式調整
                
                showLoadingIndicator(false);
                displayMessage(agentResponse, 'agent');
                */
                // --- 範例結束 ---

                // --- 以下是模擬 API 呼叫的程式碼，方便您在沒有後端時測試前端介面 ---
                // 模擬 1.5 秒的延遲
                setTimeout(() => {
                    showLoadingIndicator(false);
                    const mockResponse = `這是針對「${message}」的模擬回覆。請將此處替換為您真實的 Bedrock Agent API 呼叫。`;
                    displayMessage(mockResponse, 'agent');
                    setLoading(false); // 重新啟用輸入框
                }, 1500);
                // --- 模擬程式碼結束 ---

            } catch (error) {
                console.error('呼叫 Bedrock Agent 失敗:', error);
                showLoadingIndicator(false);
                displayMessage(`發生錯誤：${error.message}`, 'agent');
                setLoading(false); // 發生錯誤時也要重新啟用輸入框
            }
        }

        /**
         * 設置載入狀態 (禁用/啟用輸入框和按鈕)
         * @param {boolean} isLoading - 是否正在載入
         */
        function setLoading(isLoading) {
            userInput.disabled = isLoading;
            sendButton.disabled = isLoading;
            if (isLoading) {
                userInput.placeholder = 'Agent 正在思考中...';
            } else {
                userInput.placeholder = '在這裡輸入您的訊息...';
                userInput.focus();
            }
        }
        
        /**
         * 防止 HTML 注入攻擊
         * @param {string} str - 輸入字串
         * @returns {string} - 轉義後的安全字串
         */
        function escapeHTML(str) {
            const p = document.createElement('p');
            p.textContent = str;
            return p.innerHTML;
        }

        // 添加一些簡單的 CSS 動畫
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fade-in-left {
                from { opacity: 0; transform: translateX(-20px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes fade-in-right {
                from { opacity: 0; transform: translateX(20px); }
                to { opacity: 1; transform: translateX(0); }
            }
            .animate-fade-in-left {
                animation: fade-in-left 0.5s ease-out forwards;
            }
            .animate-fade-in-right {
                animation: fade-in-right 0.5s ease-out forwards;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
